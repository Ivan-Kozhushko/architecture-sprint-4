# Архитектурное решение по логированию

## Мотивация

Внедрение логирования позволит компании детализировать информацию о каждом из событии системы. Данное решение поможет в анализе и устранении ошибок. Оно добавит прозрачности операциям и облегчит диагностику потенциальных проблем.

Технические и бизнес-метрики, на которые влияет логирование:

1. Скорость обнаружения ошибок: Быстрое выявление и устранение ошибок;
2. Производительность системы: Оптимизация процессов через анализ логов;
3. Удовлетворенность клиентов: Повышение качества обслуживания за счет точной диагностики проблем.

### Логи, которые нужно собирать

INFO уровень:

1. Изменение статуса заказа
   - Время, идентификатор покупателя, номер заказа.

2. Создание и обновление заказа
   - Время, идентификатор покупателя, номер заказа, детали обновления.

3. API запросы и ответы
   - Время запроса, тип запроса, статус ответа, идентификатор сессии.

4. Обработка сообщений в RabbitMQ
   - Время обработки, тип сообщения, идентификатор сообщения.

5. Доступ к хранилищу 3D-файлов
   - Время доступа, тип операции, идентификатор файла.

Другие уровни логирования:

- ERROR: Ошибки, которые требуют немедленного вмешательства.
- DEBUG: Подробная информация для разработки, включается при необходимости.

### Приоритет логирования и трейсинга

- Первоначальные системы для логирования и трейсинга:
  - CRM API и MES API: Эти системы критичны для обработки заказов и их задержек.
  - RabbitMQ интеграция: Для обеспечения надежной передачи сообщений.

## Предлагаемое решение

Технологии для логирования:

- Filebeat для агрегации данных;
- Elastic Stack (ELK): Elasticsearch для хранения, Logstash для обработки, Kibana для визуализации.

Компоненты для внедрения:

- агенты логирования в каждый ключевой сервис;
- централизованный сервер для сбора и обработки логов.

Политика безопасности:

- доступ: Только сотрудники с ролью «Поддержка» имеют доступ к логам;
- обработка чувствительных данных: Маскирование или исключение личных данных из логов.

Политика хранения:

- хранение логов в отдельном индексе для каждой системы;
- срок хранения: 30 дней, с возможностью архивирования;
- ограничение размера логов для предотвращения переполнения.

### [Ссылка на обновленную диаграмму C4](task4.drawio)

## Анализ логов

- алертинг: Настройка уведомлений о критических ошибках и аномалиях;
- поиск аномалий: Выявление подозрительной активности, например, резкое увеличение числа заказов.