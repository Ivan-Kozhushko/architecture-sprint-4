# Выбор и настройка мониторинга в системе

## Мотивация

Мониторинг необходим для выявления проблем до того, как они как либо повлияют на бизнес. В первую очередь, необходимо выявить проблемы первее клиента. С учетом растущей нагрузки и интеграции с партнерами необходимо видеть полную картину работы системы. Так же мониторинг поможет бизнесу принимать стратегические стратегии более точно, например, с помощью бизнес-метрик. Благодаря этому все решения для реализации будут с большей вероятностью приносить реальную пользу, т.к. все они будут реализованы на основании бизнес-метрик.

## Выбор подхода к мониторингу

В данной системе можно использовать все три подхода.

1. USE: внедряем в (Shop DB, MES DB) для мониторинга использования ресурсов;
2. RED: внедряем в (Shop API, CRM API, MES API) для отслеживания надежности и производительности;
3. "Четыре золотых сигнала": внедряем для комплексного мониторинга для все системы.

## Список метрик

### API Метрики

1. Number of requests (RPS) для всех API
   - Зачем: Для понимания нагрузки и использования API различными клиентами.
   - Ярлыки: Тип запроса, пользователь.

2. Response time (latency) для всех API
   - Зачем: Для мониторинга времени отклика и выявления задержек.
   - Ярлыки: Эндпоинт, тип запроса.

3. Number of HTTP 500 для всех API
   - Зачем: Для выявления критических ошибок.
   - Ярлыки: Эндпоинт.

4. CPU % и Memory Utilisation для всех API
   - Зачем: Для отслеживания использования ресурсов и предотвращения перегрузки.
   - Ярлыки: Инстанс сервера.

5. Number of simultanious sessions для всех API
   - Зачем: Для оценки количества одновременных пользователей.
   - Ярлыки: Инстанс API.

### RabbitMQ Метрики

1. Number of dead-letter-exchange letters
   - Зачем: Для выявления сообщений, которые не могут быть обработаны.
   - Ярлыки: Тип сообщения.

2. Number of message in flight
   - Зачем: Для мониторинга сообщений, находящихся в обработке.
   - Ярлыки: Тип сообщения.

### База данных Метрики

1. Memory Utilisation и Number of connections для всех DB
   - Зачем: Для оценки использования памяти и количества подключений.
   - Ярлыки: Инстанс базы данных.

2. Size of db instance для всех DB
   - Зачем: Для мониторинга размера баз данных.
   - Ярлыки: Инстанс базы данных.

### S3 Хранилище

1. Size of S3 storage
    - Зачем: Для оценки использования объема хранилища.
    - Ярлыки: Тип данных (3D-модели).

### Трафик Метрики

1. Kb transferred (received/provided) для всех API
    - Зачем: Для отслеживания объема входящего и исходящего трафика.
    - Ярлыки: Эндпоинт.

## План действий

1. Создать инстанс time-series базы данных
   - Выбрать подходящую технологию (например, Prometheus) для хранения и анализа метрик.

2. Настроить сбор метрик для API и серверов
   - Внедрить агенты мониторинга, такие как Prometheus Exporters, для сбора данных о запросах, ошибках, времени отклика, использовании CPU и памяти.

3. Настроить мониторинг RabbitMQ
   - Внедрить метрики dead-letter-exchange и message in flight, используя соответствующие плагины и инструменты.

4. Настроить мониторинг базы данных
   - Собрать метрики использования памяти, количества подключений и размера базы данных.

5. Настроить мониторинг S3 хранилища
   - Внедрить сбор данных о размере хранилища и его использовании.

6. Установить и настроить систему визуализации
   - Использовать Grafana или аналогичный инструмент для визуализации метрик и создания дашбордов.

7. Определить пороговые значения для насыщенности
   - Установить предупреждения и алерты для CPU, памяти, количества соединений и других ключевых показателей.

8. Настроить автоматические уведомления и алерты
   - Интегрировать с системами уведомлений (например, email) для мгновенного оповещения команды о превышении пороговых значений.